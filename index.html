<!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Socket通信示例</title>
            <script src="https://cdn.tailwindcss.com"></script>
            <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
            <script>
                tailwind.config = {
                    theme: {
                        extend: {
                            colors: {
                                primary: '#3B82F6',
                                secondary: '#10B981',
                                dark: '#1E293B',
                                light: '#F8FAFC'
                            },
                            fontFamily: {
                                inter: ['Inter', 'sans-serif'],
                            },
                        }
                    }
                }
            </script>
            <style type="text/tailwindcss">
                @layer utilities {
                    .content-auto {
                        content-visibility: auto;
                    }
                    .socket-card {
                        @apply bg-white rounded-xl shadow-lg p-6 transition-all duration-300 hover:shadow-xl;
                    }
                    .btn {
                        @apply px-4 py-2 rounded-lg font-medium transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2;
                    }
                    .btn-primary {
                        @apply bg-primary text-white hover:bg-primary/90 focus:ring-primary;
                    }
                    .btn-secondary {
                        @apply bg-secondary text-white hover:bg-secondary/90 focus:ring-secondary;
                    }
                    .input-field {
                        @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-300;
                    }
                    .status-indicator {
                        @apply inline-block w-3 h-3 rounded-full mr-2;
                    }
                    .status-indicator.online {
                        @apply bg-green-500 animate-pulse;
                    }
                    .status-indicator.offline {
                        @apply bg-red-500;
                    }
                }
            </style>
        </head>
        <body class="bg-gray-50 font-inter min-h-screen">
            <div class="container mx-auto px-4 py-8 max-w-6xl">
                <header class="mb-12 text-center">
                    <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-dark mb-4">Socket通信演示</h1>
                    <p class="text-gray-600 text-lg max-w-3xl mx-auto">使用WebSocket技术实现的实时通信示例，展示客户端与服务器之间的数据传输</p>
                </header>

                <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- 发送端 -->
                    <div class="socket-card">
                        <div class="flex items-center mb-4">
                            <div class="status-indicator offline" id="sender-status"></div>
                            <h2 class="text-xl font-bold text-dark">消息发送端</h2>
                        </div>
                        <div class="mb-4">
                            <label for="message" class="block text-sm font-medium text-gray-700 mb-1">消息内容</label>
                            <textarea id="message" class="input-field" rows="4" placeholder="输入要发送的消息..."></textarea>
                        </div>
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="text-sm text-gray-500">服务器地址:</span>
                                <span id="server-address" class="font-medium">ws://localhost:65432</span>
                            </div>
                            <button id="send-btn" class="btn btn-primary flex items-center" disabled>
                                <i class="fa fa-paper-plane mr-2"></i>发送消息
                            </button>
                        </div>
                        <div class="mt-6">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">发送历史</h3>
                            <div id="send-history" class="bg-gray-50 rounded-lg p-3 h-40 overflow-y-auto text-sm">
                                <p class="text-gray-500 italic">等待连接...</p>
                            </div>
                        </div>
                    </div>

                    <!-- 接收端 -->
                    <div class="socket-card">
                        <div class="flex items-center mb-4">
                            <div class="status-indicator offline" id="receiver-status"></div>
                            <h2 class="text-xl font-bold text-dark">消息接收端</h2>
                        </div>
                        <div class="mb-4">
                            <div class="flex justify-between items-center mb-2">
                                <label for="port" class="block text-sm font-medium text-gray-700">监听端口</label>
                                <span class="text-xs text-gray-500">(默认: 65432)</span>
                            </div>
                            <input type="number" id="port" class="input-field" value="65432" min="1" max="65535">
                        </div>
                        <button id="start-server-btn" class="btn btn-secondary flex items-center w-full justify-center">
                            <i class="fa fa-play mr-2"></i>启动服务器
                        </button>
                        <div class="mt-6">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">接收历史</h3>
                            <div id="receive-history" class="bg-gray-50 rounded-lg p-3 h-40 overflow-y-auto text-sm">
                                <p class="text-gray-500 italic">服务器未启动...</p>
                            </div>
                        </div>
                    </div>
                </main>

                <footer class="mt-12 text-center text-gray-500 text-sm">
                    <p>© 2025 Socket通信演示 | 使用WebSocket和Tailwind CSS构建</p>
                </footer>
            </div>

            <script>
                // 全局变量
                let ws;
                let server;
                let receiveHistory = [];
                let sendHistory = [];

                // DOM元素
                const senderStatus = document.getElementById('sender-status');
                const receiverStatus = document.getElementById('receiver-status');
                const messageInput = document.getElementById('message');
                const sendBtn = document.getElementById('send-btn');
                const startServerBtn = document.getElementById('start-server-btn');
                const portInput = document.getElementById('port');
                const sendHistoryEl = document.getElementById('send-history');
                const receiveHistoryEl = document.getElementById('receive-history');

                // 更新发送历史
                function updateSendHistory(message, status) {
                    const timestamp = new Date().toLocaleTimeString();
                    sendHistory.unshift({ message, timestamp, status });
                    if (sendHistory.length > 10) sendHistory.pop();
                    
                    sendHistoryEl.innerHTML = sendHistory.map(item => `
                        <div class="mb-2 ${item.status ? 'text-green-700' : 'text-red-700'}">
                            <span class="font-medium">${item.timestamp}</span>: ${item.message}
                        </div>
                    `).join('');
                }

                // 更新接收历史
                function updateReceiveHistory(message) {
                    const timestamp = new Date().toLocaleTimeString();
                    receiveHistory.unshift({ message, timestamp });
                    if (receiveHistory.length > 10) receiveHistory.pop();
                    
                    receiveHistoryEl.innerHTML = receiveHistory.map(item => `
                        <div class="mb-2 text-blue-700">
                            <span class="font-medium">${item.timestamp}</span>: ${item.message}
                        </div>
                    `).join('');
                }

                // 连接到WebSocket服务器
                function connectWebSocket() {
                    const address = `ws://localhost:${portInput.value}`;
                    document.getElementById('server-address').textContent = address;
                    
                    ws = new WebSocket(address);
                    
                    ws.onopen = () => {
                        senderStatus.classList.remove('offline');
                        senderStatus.classList.add('online');
                        sendBtn.disabled = false;
                        updateSendHistory('已连接到服务器', true);
                    };
                    
                    ws.onmessage = (event) => {
                        updateReceiveHistory(event.data);
                    };
                    
                    ws.onclose = () => {
                        senderStatus.classList.remove('online');
                        senderStatus.classList.add('offline');
                        sendBtn.disabled = true;
                        updateSendHistory('与服务器的连接已关闭', false);
                    };
                    
                    ws.onerror = (error) => {
                        console.error('WebSocket错误:', error);
                        updateSendHistory('连接服务器失败', false);
                    };
                }

                // 发送消息
                sendBtn.addEventListener('click', () => {
                    const message = messageInput.value.trim();
                    if (!message) return;
                    
                    if (ws && ws.readyState === WebSocket.OPEN) {
                        ws.send(message);
                        updateSendHistory(message, true);
                        messageInput.value = '';
                    } else {
                        updateSendHistory(message, false);
                    }
                });

                // 启动服务器
                startServerBtn.addEventListener('click', () => {
                    if (server) {
                        // 关闭服务器
                        server.close();
                        server = null;
                        receiverStatus.classList.remove('online');
                        receiverStatus.classList.add('offline');
                        startServerBtn.innerHTML = '<i class="fa fa-play mr-2"></i>启动服务器';
                        updateReceiveHistory('服务器已停止');
                        portInput.disabled = false;
                        
                        // 如果WebSocket已连接，也关闭它
                        if (ws && ws.readyState === WebSocket.OPEN) {
                            ws.close();
                        }
                    } else {
                        // 启动服务器
                        const port = parseInt(portInput.value, 10);
                        if (isNaN(port) || port < 1 || port > 65535) {
                            alert('请输入有效的端口号 (1-65535)');
                            return;
                        }
                        
                        // 模拟WebSocket服务器
                        updateReceiveHistory(`服务器正在监听端口 ${port}...`);
                        receiverStatus.classList.remove('offline');
                        receiverStatus.classList.add('online');
                        startServerBtn.innerHTML = '<i class="fa fa-stop mr-2"></i>停止服务器';
                        portInput.disabled = true;
                        
                        // 连接到模拟的WebSocket服务器
                        connectWebSocket();
                    }
                });

                // 回车键发送消息
                messageInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendBtn.click();
                    }
                });
            </script>
        </body>
        </html>
    
